@model LibraryManagementSystem.Models.Book

@{
    ViewData["Title"] = "Details";
}

<h1>@Model.Title</h1>

<div>
    <h4>Book Information</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Author</dt>
        <dd class="col-sm-10">@Model.Author</dd>
        <dt class="col-sm-2">Year</dt>
        <dd class="col-sm-10">@Model.PublishedYear</dd>
        <dt class="col-sm-2">Genre</dt>
        <dd class="col-sm-10">@Model.Genre</dd>
    </dl>
</div>

<hr />

<h3>Reviews</h3>
@if (Model.Reviews != null && Model.Reviews.Any())
{
    @foreach (var review in Model.Reviews)
    {
        <div class="card mb-2">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Rating: @review.Rating / 5</h6>
                <p class="card-text">@review.Content</p>

                <div class="d-flex align-items-center gap-3">
                    <form asp-action="Vote" method="post" class="d-inline">
                        <input type="hidden" name="reviewId" value="@review.Id" />
                        <input type="hidden" name="isUpvote" value="true" />
                        <button type="submit" class="btn btn-sm btn-outline-success">
                            👍 @(review.ReviewVotes?.Count(v => v.IsUpvote) ?? 0)
                        </button>
                    </form>

                    <form asp-action="Vote" method="post" class="d-inline">
                        <input type="hidden" name="reviewId" value="@review.Id" />
                        <input type="hidden" name="isUpvote" value="false" />
                        <button type="submit" class="btn btn-sm btn-outline-danger">
                            👎 @(review.ReviewVotes?.Count(v => !v.IsUpvote) ?? 0)
                        </button>
                    </form>
                </div>

                <footer class="blockquote-footer mt-2">
                    By @(review.User?.UserName ?? "Anonymous") on @review.DateCreated.ToShortDateString()
                </footer>
            </div>
        </div>
    }
}
else
{
    <p>No reviews yet. Be the first to write one!</p>
}

<hr />

@if (User.Identity.IsAuthenticated)
{
    <h4>Add a Review</h4>
    <form asp-action="AddReview">
        <input type="hidden" name="BookId" value="@Model.Id" />
        <div class="form-group">
            <label class="control-label">Rating (1-5)</label>
            <input type="number" name="Rating" class="form-control" min="1" max="5" required />
        </div>
        <div class="form-group">
            <label class="control-label">Your Review</label>
            <textarea name="Content" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-success mt-2">Submit Review</button>
    </form>
}
else
{
    <p><a asp-area="Identity" asp-page="/Account/Login">Login</a> to write a review.</p>
}

<div class="mt-3">
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>